{
	"info": {
		"_postman_id": "374f3ace-f56e-4b34-ae64-ea5f13e30284",
		"name": "MSRP Happy Path Automation",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Sign in anonymously",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "77075e47-3ed6-4c20-976f-a14e10548101",
						"exec": [
							"pm.test(\"get id token & FB UID\", function () {",
							"       ",
							"    ",
							"    var jsonData = JSON.parse(responseBody);",
							"    postman.setEnvironmentVariable(\"TOKEN\", jsonData.idToken);",
							"    postman.setEnvironmentVariable(\"FB_UID\", jsonData.localId);",
							"    console.log(\"TOKEN=====\"+jsonData.idToken)",
							"    console.log(\"FB_UID=====\"+jsonData.localId)",
							"",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"returnSecureToken\":true}"
				},
				"url": {
					"raw": "https://identitytoolkit.googleapis.com/v1/accounts:signUp?key={{GOOGLE_API_KEY}}",
					"protocol": "https",
					"host": [
						"identitytoolkit",
						"googleapis",
						"com"
					],
					"path": [
						"v1",
						"accounts:signUp"
					],
					"query": [
						{
							"key": "key",
							"value": "{{GOOGLE_API_KEY}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Admin - Add Mission From DB",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{TOKEN}}",
							"type": "string"
						}
					]
				},
				"method": "PATCH",
				"header": [
					{
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman.",
						"key": "Authorization",
						"type": "text",
						"value": "",
						"disabled": true
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n   \"fields\":{\n      \"mid\":{\n         \"stringValue\":\"0_test_mission\"\n      },\n      \"endpoint\":{\n         \"stringValue\":\"/mission_daily/0_test_mission\"\n      },\n      \"missionName\":{\n         \"stringValue\":\"test-mission-name\"\n      },\n      \"titleId\":{\n         \"stringValue\":\"titleId\"\n      },\n      \"descriptionId\":{\n         \"stringValue\":\"descriptionId\"\n      },\n      \"missionType\":{\n         \"stringValue\":\"mission_daily\"\n      },\n      \"startDate\":{\n         \"stringValue\":\"2019-10-01T10:00:00\"\n      },\n      \"joinStartDate\":{\n         \"stringValue\":\"2019-10-01T10:00:00\"\n      },\n      \"joinEndDate\":{\n         \"stringValue\":\"2020-10-01T10:00:00\"\n      },\n      \"expiredDate\":{\n         \"stringValue\":\"2020-10-01T10:00:00\"\n      },\n      \"redeemEndDate\":{\n         \"stringValue\":\"2020-10-01T10:00:00\"\n      },\n      \"minVersion\":{\n         \"integerValue\":\"1\"\n      },\n      \"interestPings\":{\n         \"arrayValue\":{\n            \"values\":[\n               {\n                  \"stringValue\":\"0_test_mission_ping\"\n               }\n            ]\n         }\n      },\n      \"missionParams\":{\n         \"mapValue\":{\n            \"fields\":{\n               \"totalDays\":{\n                  \"integerValue\":\"1\"\n               },\n               \"message\":{\n                  \"arrayValue\":{\n                     \"values\":[\n                        {\n                           \"stringValue\":\"msrp_completed_toast_day1\"\n                        },\n                        {\n                           \"stringValue\":\"msrp_completed_toast_day2\"\n                        },\n                        {\n                           \"stringValue\":\"msrp_completed_toast_day3\"\n                        },\n                        {\n                           \"stringValue\":\"msrp_completed_toast_day4\"\n                        },\n                        {\n                           \"stringValue\":\"msrp_completed_toast_day5\"\n                        },\n                        {\n                           \"stringValue\":\"msrp_completed_toast_day6\"\n                        },\n                        {\n                           \"stringValue\":\"msrp_completed_toast_day7\"\n                        }\n                     ]\n                  }\n               }\n            }\n         }\n      },\n      \"rewardType\":{\n         \"stringValue\":\"0_test_coupon\"\n      },\n      \"joinQuota\":{\n         \"integerValue\":\"75\"\n      },\n      \"imageUrl\":{\n         \"stringValue\":\"https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_92x30dp.png\"\n      }\n   }\n}"
				},
				"url": {
					"raw": "https://firestore.googleapis.com/v1/projects/{{PROJECT_ID}}/databases/(default)/documents/mission_daily/0_test_mission",
					"protocol": "https",
					"host": [
						"firestore",
						"googleapis",
						"com"
					],
					"path": [
						"v1",
						"projects",
						"{{PROJECT_ID}}",
						"databases",
						"(default)",
						"documents",
						"mission_daily",
						"0_test_mission"
					]
				},
				"description": "Normally you shouldn't see this"
			},
			"response": []
		},
		{
			"name": "Admin - Add Reward From DB",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{TOKEN}}",
							"type": "string"
						}
					]
				},
				"method": "PATCH",
				"header": [
					{
						"key": "Authorization",
						"type": "text",
						"value": "",
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman.",
						"disabled": true
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n   \"fields\":{\n      \"code\":{\n         \"stringValue\":\"0_test_code\"\n      },\n      \"display_name\":{\n         \"stringValue\":\"Kuba Koupon\"\n      },\n      \"created_timestamp\":{\n         \"doubleValue\":1570037369674\n      },\n      \"expire_date\":{\n         \"doubleValue\":1570037369674\n      },\n      \"mid\":{\n         \"stringValue\":\"0_test_mission\"\n      },\n      \"rid\":{\n         \"stringValue\":\"0_test_code\"\n      },\n      \"uid\":{\n         \"stringValue\":\"\"\n      },\n      \"updated_timestamp\":{\n         \"doubleValue\":1570037369674\n      }\n   }\n}"
				},
				"url": {
					"raw": "https://firestore.googleapis.com/v1/projects/{{PROJECT_ID}}/databases/(default)/documents/0_test_coupon/0_test_code",
					"protocol": "https",
					"host": [
						"firestore",
						"googleapis",
						"com"
					],
					"path": [
						"v1",
						"projects",
						"{{PROJECT_ID}}",
						"databases",
						"(default)",
						"documents",
						"0_test_coupon",
						"0_test_code"
					]
				},
				"description": "Normally you shouldn't see this"
			},
			"response": []
		},
		{
			"name": "Admin - Group Missions",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{TOKEN}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n   \"missions\":[\n      {\n         \"endpoint\":\"/mission_daily/0_test_mission\"\n      }\n   ]\n}"
				},
				"url": {
					"raw": "{{SERVER}}/api/v1/group/0_mission_group_test/missions",
					"host": [
						"{{SERVER}}"
					],
					"path": [
						"api",
						"v1",
						"group",
						"0_mission_group_test",
						"missions"
					]
				},
				"description": "Group missions"
			},
			"response": []
		},
		{
			"name": "Get missions",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "a012470c-bbda-4afc-8f01-7a339d858cbd",
						"exec": [
							"pm.test(\"get mission id\", function () {",
							"       ",
							"    ",
							"    var missions = JSON.parse(responseBody).result;",
							"          console.log(\"missions.length=====\"+missions.length);",
							"",
							"    for (i = 0; i < missions.length; i++) {",
							"      console.log(\"mid=====\"+missions[i].mid);",
							"      console.log(\"status=====\"+missions[i].status);",
							"      if (missions[i].status == 0 ){",
							"         postman.setEnvironmentVariable(\"MISSION_TO_JOIN\", missions[i].mid);",
							"         postman.setEnvironmentVariable(\"MISSION_TO_JOIN_PING\", missions[i].events[0]);",
							"      }",
							"    }",
							"    ",
							"",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{TOKEN}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"type": "text",
						"value": "",
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman.",
						"disabled": true
					}
				],
				"url": {
					"raw": "{{SERVER}}/api/v1/group/0_mission_group_test/missions?tz=Asia/Taipei",
					"host": [
						"{{SERVER}}"
					],
					"path": [
						"api",
						"v1",
						"group",
						"0_mission_group_test",
						"missions"
					],
					"query": [
						{
							"key": "tz",
							"value": "Asia/Taipei"
						}
					]
				},
				"description": "Mission List API"
			},
			"response": []
		},
		{
			"name": "Join mission",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{TOKEN}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"type": "text",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{SERVER}}/api/v1/missions/mission_daily/{{MISSION_TO_JOIN}}?tz=UTC",
					"host": [
						"{{SERVER}}"
					],
					"path": [
						"api",
						"v1",
						"missions",
						"mission_daily",
						"{{MISSION_TO_JOIN}}"
					],
					"query": [
						{
							"key": "tz",
							"value": "UTC"
						}
					]
				},
				"description": "Join missions"
			},
			"response": []
		},
		{
			"name": "Check in",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{TOKEN}}",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [],
				"url": {
					"raw": "{{SERVER}}/api/v1/ping/{{MISSION_TO_JOIN_PING}}?tz=UTC",
					"host": [
						"{{SERVER}}"
					],
					"path": [
						"api",
						"v1",
						"ping",
						"{{MISSION_TO_JOIN_PING}}"
					],
					"query": [
						{
							"key": "tz",
							"value": "UTC"
						}
					]
				},
				"description": "Join API"
			},
			"response": []
		},
		{
			"name": "Query User Doc Id",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "54d390d3-d293-4bb5-8027-188d471f5097",
						"exec": [
							"pm.test(\"get user doc id\", function () {",
							"       ",
							"    ",
							"    var jsonData = JSON.parse(responseBody);",
							"    // postman.setEnvironmentVariable(\"TOKEN\", jsonData.idToken);",
							"    var userDocId = jsonData[0].document.fields.uid.stringValue;",
							"    postman.setEnvironmentVariable(\"USER_DOC_ID\", userDocId);",
							"    console.log(\"UserDocId =====\"+userDocId)",
							"",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{TOKEN}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman.",
						"key": "Authorization",
						"type": "text",
						"value": "",
						"disabled": true
					},
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n      \"structuredQuery\": {\n            \"where\" : {\n                \"fieldFilter\" : { \n                      \"field\": { \"fieldPath\" : \"firebase_uid\" } , \n                                 \"op\":\"EQUAL\", \n                                 \"value\": { \"stringValue\" : \"{{FB_UID}}\" }\n                                }\n            },\n            \"from\": [{\"collectionId\": \"users\"}]\n      }\n\n    }"
				},
				"url": {
					"raw": "https://firestore.googleapis.com/v1beta1/projects/{{PROJECT_ID}}/databases/(default)/documents:runQuery",
					"protocol": "https",
					"host": [
						"firestore",
						"googleapis",
						"com"
					],
					"path": [
						"v1beta1",
						"projects",
						"{{PROJECT_ID}}",
						"databases",
						"(default)",
						"documents:runQuery"
					]
				},
				"description": "Normally you shouldn't see this"
			},
			"response": []
		},
		{
			"name": "Promote User",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{TOKEN}}",
							"type": "string"
						}
					]
				},
				"method": "PATCH",
				"header": [
					{
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman.",
						"key": "Authorization",
						"type": "text",
						"value": "",
						"disabled": true
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"fields\": {\n\t\t\"firefox_uid\": {\n\t\t\t\"stringValue\": \"a testing fx user\"\n\t\t},\n\t\t\"status\": {\n\t\t\t\"stringValue\": \"sign-in\"\n\t\t},\n\t\t\"email\": {\n\t\t\t\"stringValue\": \"ci-test@fakemail.com\"\n\t\t}\n\t\t\n\t}\n}"
				},
				"url": {
					"raw": "https://firestore.googleapis.com/v1beta1/projects/{{PROJECT_ID}}/databases/(default)/documents/users/{{USER_DOC_ID}}?updateMask.fieldPaths=firefox_uid&updateMask.fieldPaths=status&updateMask.fieldPaths=email\n",
					"protocol": "https",
					"host": [
						"firestore",
						"googleapis",
						"com"
					],
					"path": [
						"v1beta1",
						"projects",
						"{{PROJECT_ID}}",
						"databases",
						"(default)",
						"documents",
						"users",
						"{{USER_DOC_ID}}"
					],
					"query": [
						{
							"key": "updateMask.fieldPaths",
							"value": "firefox_uid"
						},
						{
							"key": "updateMask.fieldPaths",
							"value": "status"
						},
						{
							"key": "updateMask.fieldPaths",
							"value": "email\n"
						}
					]
				},
				"description": "Normally you shouldn't see this"
			},
			"response": []
		},
		{
			"name": "Redeem",
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{TOKEN}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"type": "text",
						"value": "",
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman.",
						"disabled": true
					}
				],
				"url": {
					"raw": "{{SERVER}}/api/v1/redeem/mission_daily?mid={{MISSION_TO_JOIN}}&tz=UTC",
					"host": [
						"{{SERVER}}"
					],
					"path": [
						"api",
						"v1",
						"redeem",
						"mission_daily"
					],
					"query": [
						{
							"key": "mid",
							"value": "{{MISSION_TO_JOIN}}"
						},
						{
							"key": "tz",
							"value": "UTC"
						}
					]
				},
				"description": "Mission List API"
			},
			"response": []
		}
	],
	"protocolProfileBehavior": {}
}